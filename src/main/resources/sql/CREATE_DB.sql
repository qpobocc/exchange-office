CREATE DATABASE DB_EXCHANGE_OFFICE
GO

USE DB_EXCHANGE_OFFICE
GO

CREATE TABLE CURRENCIES
(
    CODE char(3) NOT NULL,
    CONSTRAINT PK_CURRENCIES PRIMARY KEY CLUSTERED (CODE ASC)
)
GO

CREATE TABLE BALANCES
(
    CURRENCY_CODE   char(3)  NOT NULL,
    AMOUNT          float    NOT NULL,
    TMS_LAST_UPDATE datetime NOT NULL,
    CONSTRAINT PK_BALANCES PRIMARY KEY CLUSTERED (CURRENCY_CODE ASC)
)
GO

CREATE TABLE CURRENCY_EXCHANGES
(
    ID             bigint IDENTITY (1,1) NOT NULL,
    IN_CUR_CODE    char(3)               NOT NULL,
    IN_CUR_AMOUNT  float                 NOT NULL,
    OUT_CUR_CODE   char(3)               NOT NULL,
    OUT_CUR_AMOUNT float                 NOT NULL,
    EXCHANGE_RATE  float                 NOT NULL,
    EMPLOYEE_CODE  char(6)               NOT NULL,
    EXCHANGE_DATE  datetime              NOT NULL,
    CONSTRAINT PK_CURRENCY_EXCHANGES PRIMARY KEY CLUSTERED (ID ASC)
)
GO

CREATE TABLE EMPLOYEES
(
    CODE      char(6)     NOT NULL,
    FULL_NAME varchar(50) NULL,
    CONSTRAINT PK_EMPLOYEES PRIMARY KEY CLUSTERED (CODE ASC)
)
GO

CREATE TABLE EXCHANGE_RATES
(
    CURRENCY_CODE char(3) NOT NULL,
    RATE_DATE     date    NOT NULL,
    AMOUNT        int     NOT NULL,
    RATE          float   NOT NULL,
    CONSTRAINT PK_EXCHANGE_RATE PRIMARY KEY CLUSTERED (CURRENCY_CODE ASC, RATE_DATE ASC)
)
GO

INSERT INTO CURRENCIES (CODE)
VALUES (N'EUR'),
       (N'JPY'),
       (N'MDL'),
       (N'USD')
GO

INSERT INTO BALANCES (CURRENCY_CODE, AMOUNT, TMS_LAST_UPDATE)
VALUES (N'EUR', 200498.11512990322, CAST(N'2020-09-13T22:06:04.250' AS DateTime)),
       (N'JPY', 1000200010, CAST(N'2020-09-13T22:06:04.250' AS DateTime)),
       (N'MDL', 984000, CAST(N'2020-09-13T22:06:04.250' AS DateTime)),
       (N'USD', 99469.746083198275, CAST(N'2020-09-13T22:06:04.250' AS DateTime))
GO

SET IDENTITY_INSERT CURRENCY_EXCHANGES ON
INSERT INTO CURRENCY_EXCHANGES (ID, IN_CUR_CODE, IN_CUR_AMOUNT, OUT_CUR_CODE, OUT_CUR_AMOUNT, EXCHANGE_RATE,
                                EMPLOYEE_CODE, EXCHANGE_DATE)
VALUES (1, N'EUR', 100, N'MDL', 2000, 20, N'crm001', CAST(N'2020-09-13T22:08:41.227' AS DateTime)),
       (2, N'MDL', 2000, N'EUR', 101.88487009679064, 0.050942435048395317, N'crm002',
        CAST(N'2020-09-13T22:18:23.920' AS DateTime)),
       (3, N'JPY', 200000, N'MDL', 320000000, 1600, N'crm002', CAST(N'2020-09-13T22:19:56.967' AS DateTime)),
       (4, N'JPY', 10, N'MDL', 16000, 1600, N'crm001', CAST(N'2020-09-13T22:22:32.133' AS DateTime)),
       (5, N'EUR', 500, N'USD', 530.25391680172868, 1.0605078336034575, N'crm001',
        CAST(N'2020-09-13T22:23:32.057' AS DateTime))
SET IDENTITY_INSERT CURRENCY_EXCHANGES OFF
GO

INSERT INTO EMPLOYEES (CODE, FULL_NAME)
VALUES (N'crm001', N'John Doe'),
       (N'crm002', N'Jane Doe')
GO

INSERT INTO EXCHANGE_RATES (CURRENCY_CODE, RATE_DATE, AMOUNT, RATE)
VALUES (N'EUR', CAST(N'2020-09-13' AS Date), 1, 19.63),
       (N'JPY', CAST(N'2020-09-13' AS Date), 100, 16),
       (N'MDL', CAST(N'2020-09-13' AS Date), 1, 1),
       (N'USD', CAST(N'2020-09-13' AS Date), 1, 18.51)
GO

ALTER TABLE BALANCES
    WITH CHECK ADD CONSTRAINT FK_BALANCES_CURRENCIES FOREIGN KEY (CURRENCY_CODE)
        REFERENCES CURRENCIES (CODE)
GO
ALTER TABLE BALANCES
    CHECK CONSTRAINT FK_BALANCES_CURRENCIES
GO
ALTER TABLE CURRENCY_EXCHANGES
    WITH CHECK ADD CONSTRAINT FK_EXCHANGES_CURRENCIES FOREIGN KEY (IN_CUR_CODE)
        REFERENCES CURRENCIES (CODE)
GO
ALTER TABLE CURRENCY_EXCHANGES
    CHECK CONSTRAINT FK_EXCHANGES_CURRENCIES
GO
ALTER TABLE CURRENCY_EXCHANGES
    WITH CHECK ADD CONSTRAINT FK_EXCHANGES_CURRENCIES1 FOREIGN KEY (OUT_CUR_CODE)
        REFERENCES CURRENCIES (CODE)
GO
ALTER TABLE CURRENCY_EXCHANGES
    CHECK CONSTRAINT FK_EXCHANGES_CURRENCIES1
GO
ALTER TABLE CURRENCY_EXCHANGES
    WITH CHECK ADD CONSTRAINT FK_EXCHANGES_EMPLOYEES FOREIGN KEY (EMPLOYEE_CODE)
        REFERENCES EMPLOYEES (CODE)
GO
ALTER TABLE CURRENCY_EXCHANGES
    CHECK CONSTRAINT FK_EXCHANGES_EMPLOYEES
GO
ALTER TABLE EXCHANGE_RATES
    WITH CHECK ADD CONSTRAINT FK_EXCHANGE_RATE_CURRENCIES FOREIGN KEY (CURRENCY_CODE)
        REFERENCES CURRENCIES (CODE)
GO
ALTER TABLE EXCHANGE_RATES
    CHECK CONSTRAINT FK_EXCHANGE_RATE_CURRENCIES
GO

